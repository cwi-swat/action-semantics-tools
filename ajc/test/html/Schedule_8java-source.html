<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Schedule.java Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.8.1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="packages.html">Packages</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>Schedule.java</h1><a href="Schedule_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 package ajc;
00003 
00004 import ajc.data.*;
00005 
00006 import java.util.<a class="code" href="classHashtable.html">Hashtable</a>;
00007 import java.util.Calendar;
00008 import java.util.Random;
00009 
00010 <font class="comment">/* Singleton */</font>
<a name="l00011"></a><a class="code" href="classSchedule.html">00011</a> <font class="keyword">public</font> <font class="keyword">class </font><a class="code" href="classSchedule.html">Schedule</a> implements <a class="code" href="interfaceScheduling.html">Scheduling</a> {
<a name="l00012"></a><a class="code" href="classSchedule.html#r0">00012</a>     <font class="keyword">private</font> <font class="keyword">static</font> <a class="code" href="classSchedule.html">Schedule</a> theSchedule = null;
00013 
<a name="l00014"></a><a class="code" href="classSchedule.html#o0">00014</a>     <font class="keyword">private</font> <a class="code" href="interfaceDataFactory.html">DataFactory</a> factory;
<a name="l00015"></a><a class="code" href="classSchedule.html#o1">00015</a>     <font class="keyword">private</font> <a class="code" href="classHashtable.html">Hashtable</a> threads = <font class="keyword">new</font> Hashtable();
<a name="l00016"></a><a class="code" href="classSchedule.html#o2">00016</a>     <font class="keyword">private</font> <a class="code" href="classHashtable.html">Hashtable</a> agents = <font class="keyword">new</font> Hashtable();
<a name="l00017"></a><a class="code" href="classSchedule.html#o3">00017</a>     <font class="keyword">private</font> <a class="code" href="classHashtable.html">Hashtable</a> buffers = <font class="keyword">new</font> Hashtable();
00018 
<a name="l00019"></a><a class="code" href="classSchedule.html#c0">00019</a>     <font class="keyword">private</font> Schedule(<a class="code" href="interfaceDataFactory.html">DataFactory</a> factory)<font class="keyword"> </font>{
00020         <font class="keyword">this</font>.factory = factory;
00021         <a class="code" href="interfaceAgent.html">Agent</a> agent = factory.<a class="code" href="interfaceDataFactory.html#a10">makeAgent</a>();
00022         Thread thread = Thread.currentThread();
00023         agents.put(agent, thread);
00024         threads.put(thread, agent);
00025         buffers.put(agent, <font class="keyword">new</font> TaggedBuffers(factory));
00026     }
00027 
<a name="l00028"></a><a class="code" href="classSchedule.html#d0">00028</a>     <font class="keyword">public</font> <font class="keyword">static</font> <font class="keywordtype">void</font> initSchedule(<a class="code" href="interfaceDataFactory.html">DataFactory</a> factory)<font class="keyword"> </font>{
00029         theSchedule = <font class="keyword">new</font> Schedule(factory);
00030     }
00031 
<a name="l00032"></a><a class="code" href="classSchedule.html#d1">00032</a>     <font class="keyword">public</font> <font class="keyword">static</font> <a class="code" href="classSchedule.html">Schedule</a> getSchedule()<font class="keyword"> </font>{
00033         <font class="keywordflow">if</font> (theSchedule == null)
00034             <font class="keywordflow">throw</font> <font class="keyword">new</font> RuntimeException(<font class="stringliteral">"Initialize schedule first!"</font>);
00035         <font class="keywordflow">return</font> theSchedule;
00036     }
00037 
00038     <font class="comment">/* Interface */</font>
00039 
<a name="l00040"></a><a class="code" href="classSchedule.html#a0">00040</a>     <font class="keyword">public</font> <a class="code" href="interfaceEmpty.html">Empty</a> <a class="code" href="interfaceScheduling.html#a0">send</a>(<a class="code" href="interfaceAgent.html">Agent</a> agent, <a class="code" href="interfaceMessage.html">Message</a> message, <a class="code" href="interfaceMessageTag.html">MessageTag</a> messageTag) throws <a class="code" href="classExceptional.html">Exceptional</a> {
00041         <font class="keywordflow">if</font> (agents.containsKey(agent)) {
00042             <a class="code" href="classTaggedBuffers.html">TaggedBuffers</a> taggedBuffers = (<a class="code" href="classTaggedBuffers.html">TaggedBuffers</a>)buffers.get(agent);
00043             taggedBuffers.<a class="code" href="classTaggedBuffers.html#a1">queue</a>(messageTag, message);
00044         }
00045         <font class="keywordflow">throw</font> <font class="keyword">new</font> Exceptional(factory.<a class="code" href="interfaceDataFactory.html#a0">makeEmpty</a>());
00046     }   
00047         
<a name="l00048"></a><a class="code" href="classSchedule.html#a1">00048</a>     <font class="keyword">public</font> <a class="code" href="interfaceMessage.html">Message</a> <a class="code" href="interfaceScheduling.html#a1">receive</a>(<a class="code" href="interfaceMessageTag.html">MessageTag</a> messageTag) throws <a class="code" href="classExceptional.html">Exceptional</a> {
00049         Thread thread = Thread.currentThread();
00050         <font class="keywordflow">if</font> (threads.containsKey(thread)) {
00051             <a class="code" href="interfaceAgent.html">Agent</a> agent = (<a class="code" href="interfaceAgent.html">Agent</a>)threads.get(thread);
00052             <a class="code" href="classTaggedBuffers.html">TaggedBuffers</a> taggedBuffers = (<a class="code" href="classTaggedBuffers.html">TaggedBuffers</a>)buffers.get(agent);
00053             <font class="keywordflow">return</font> taggedBuffers.<a class="code" href="classTaggedBuffers.html#a2">dequeue</a>(messageTag);
00054         }
00055         <font class="keywordflow">throw</font> <font class="keyword">new</font> Exceptional(factory.<a class="code" href="interfaceDataFactory.html#a0">makeEmpty</a>());
00056     }   
00057 
00058 
<a name="l00059"></a><a class="code" href="classSchedule.html#a2">00059</a>     <font class="keyword">public</font> <a class="code" href="interfaceAgent.html">Agent</a> <a class="code" href="interfaceScheduling.html#a2">activate</a>(<a class="code" href="interfaceAction.html">Action</a> action)<font class="keyword"> </font>{
00060         <a class="code" href="interfaceAgent.html">Agent</a> agent = factory.<a class="code" href="interfaceDataFactory.html#a10">makeAgent</a>();
00061         Thread thread = <font class="keyword">new</font> Thread(action);
00062         agents.put(agent, thread);
00063         threads.put(thread, agent);
00064         buffers.put(agent, <font class="keyword">new</font> TaggedBuffers(factory));
00065         thread.start();
00066         <font class="keywordflow">return</font> agent;
00067     }
00068 
<a name="l00069"></a><a class="code" href="classSchedule.html#a3">00069</a>     <font class="keyword">public</font> <a class="code" href="interfaceEmpty.html">Empty</a> <a class="code" href="interfaceScheduling.html#a3">deactivate</a>(<a class="code" href="interfaceAgent.html">Agent</a> agent) throws <a class="code" href="classExceptional.html">Exceptional</a> {
00070         <font class="keywordflow">if</font> (agents.containsKey(agent)) {
00071             Thread thread = (Thread)(agents.get(agent));
00072             thread.interrupt();
00073             agents.remove(agent);
00074             threads.remove(thread);
00075             <font class="keywordflow">return</font> factory.<a class="code" href="interfaceDataFactory.html#a0">makeEmpty</a>();
00076         }
00077         <font class="keywordflow">throw</font> <font class="keyword">new</font> Exceptional(factory.<a class="code" href="interfaceDataFactory.html#a0">makeEmpty</a>());
00078     }
00079 
<a name="l00080"></a><a class="code" href="classSchedule.html#a4">00080</a>     <font class="keyword">public</font> <a class="code" href="interfaceAgent.html">Agent</a> <a class="code" href="interfaceScheduling.html#a4">giveCurrentAgent</a>()<font class="keyword"> </font>{
00081         <font class="keywordflow">return</font> (<a class="code" href="interfaceAgent.html">Agent</a>)(threads.get(Thread.currentThread()));
00082     }
00083 
<a name="l00084"></a><a class="code" href="classSchedule.html#a5">00084</a>     <font class="keyword">public</font> <a class="code" href="interfaceInt.html">Int</a> <a class="code" href="interfaceScheduling.html#a5">giveCurrentTime</a>()<font class="keyword"> </font>{
00085         <font class="keywordflow">return</font> factory.<a class="code" href="interfaceDataFactory.html#a2">makeInt</a>((Calendar.getInstance()).get(Calendar.SECOND));
00086 
00087     }
00088 
<a name="l00089"></a><a class="code" href="classSchedule.html#a6">00089</a>     <font class="keyword">public</font> <a class="code" href="interfaceInt.html">Int</a> <a class="code" href="interfaceScheduling.html#a6">chooseNatural</a>()<font class="keyword"> </font>{
00090         <font class="keywordflow">return</font> factory.<a class="code" href="interfaceDataFactory.html#a2">makeInt</a>((<font class="keyword">new</font> Random()).nextInt());
00091     }
00092 
00093 }
00094 
00095 
00096         
</pre></div><hr><address><small>Generated at Thu Sep 12 20:07:44 2002 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.8.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
