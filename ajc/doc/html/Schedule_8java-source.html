<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Schedule.java Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.8.1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="packages.html">Packages</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>Schedule.java</h1><a href="Schedule_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 package ajc;
00003 
00004 import ajc.data.*;
00005 
00006 import java.util.<a class="code" href="classHashtable.html">Hashtable</a>;
00007 import java.util.Calendar;
00008 import java.util.Random;
00009 
00010 <font class="comment">/* Singleton */</font>
<a name="l00011"></a><a class="code" href="classSchedule.html">00011</a> <font class="keyword">public</font> <font class="keyword">class </font><a class="code" href="classSchedule.html">Schedule</a> implements <a class="code" href="interfaceScheduling.html">Scheduling</a> {
00012     <font class="keyword">private</font> <font class="keyword">static</font> <a class="code" href="classSchedule.html">Schedule</a> theSchedule = null;
00013 
00014     <font class="keyword">private</font> <a class="code" href="interfaceDataFactory.html">DataFactory</a> factory;
00015     <font class="keyword">private</font> <a class="code" href="classHashtable.html">Hashtable</a> threads = <font class="keyword">new</font> Hashtable();
00016     <font class="keyword">private</font> <a class="code" href="classHashtable.html">Hashtable</a> agents = <font class="keyword">new</font> Hashtable();
00017     <font class="keyword">private</font> <a class="code" href="classHashtable.html">Hashtable</a> buffers = <font class="keyword">new</font> Hashtable();
00018 
00019     <font class="keyword">private</font> Schedule(<a class="code" href="interfaceDataFactory.html">DataFactory</a> factory)<font class="keyword"> </font>{
00020         <font class="keyword">this</font>.factory = factory;
00021         <a class="code" href="interfaceAgent.html">Agent</a> agent = factory.<a class="code" href="interfaceDataFactory.html#a11">makeAgent</a>();
00022         Thread thread = Thread.currentThread();
00023         agents.put(agent, thread);
00024         threads.put(thread, agent);
00025         buffers.put(agent, <font class="keyword">new</font> TaggedBuffers(factory));
00026     }
00027 
<a name="l00028"></a><a class="code" href="classSchedule.html#d0">00028</a>     <font class="keyword">public</font> <font class="keyword">static</font> <font class="keywordtype">void</font> initSchedule(<a class="code" href="interfaceDataFactory.html">DataFactory</a> factory)<font class="keyword"> </font>{
00029         theSchedule = <font class="keyword">new</font> Schedule(factory);
00030     }
00031 
<a name="l00032"></a><a class="code" href="classSchedule.html#d1">00032</a>     <font class="keyword">public</font> <font class="keyword">static</font> <a class="code" href="classSchedule.html">Schedule</a> getSchedule()<font class="keyword"> </font>{
00033         <font class="keywordflow">if</font> (theSchedule == null)
00034             <font class="keywordflow">throw</font> <font class="keyword">new</font> RuntimeException(<font class="stringliteral">"Initialize schedule first!"</font>);
00035         <font class="keywordflow">return</font> theSchedule;
00036     }
00037 
00038     <font class="comment">/* Interface */</font>
00039 
<a name="l00040"></a><a class="code" href="classSchedule.html#a0">00040</a>     <font class="keyword">public</font> synchronized <a class="code" href="interfaceEmpty.html">Empty</a> <a class="code" href="interfaceScheduling.html#a0">send</a>(<a class="code" href="interfaceAgent.html">Agent</a> agent, <a class="code" href="interfaceMessage.html">Message</a> message, <a class="code" href="interfaceMessageTag.html">MessageTag</a> messageTag) throws <a class="code" href="classExceptional.html">Exceptional</a> {
00041         <font class="keywordflow">if</font> (agents.containsKey(agent)) {
00042             <a class="code" href="classTaggedBuffers.html">TaggedBuffers</a> taggedBuffers = (<a class="code" href="classTaggedBuffers.html">TaggedBuffers</a>)buffers.get(agent);
00043             taggedBuffers.<a class="code" href="classTaggedBuffers.html#a1">queue</a>(messageTag, message);
00044         }
00045         <font class="keywordflow">throw</font> <font class="keyword">new</font> Exceptional(factory.<a class="code" href="interfaceDataFactory.html#a0">makeEmpty</a>());
00046     }   
00047         
<a name="l00048"></a><a class="code" href="classSchedule.html#a1">00048</a>     <font class="keyword">public</font> synchronized <a class="code" href="interfaceMessage.html">Message</a> <a class="code" href="interfaceScheduling.html#a1">receive</a>(<a class="code" href="interfaceMessageTag.html">MessageTag</a> messageTag) 
00049         throws <a class="code" href="classExceptional.html">Exceptional</a> {
00050         Thread thread = Thread.currentThread();
00051         <font class="keywordflow">if</font> (threads.containsKey(thread)) {
00052             <a class="code" href="interfaceAgent.html">Agent</a> agent = (<a class="code" href="interfaceAgent.html">Agent</a>)threads.get(thread);
00053             <a class="code" href="classTaggedBuffers.html">TaggedBuffers</a> taggedBuffers = (<a class="code" href="classTaggedBuffers.html">TaggedBuffers</a>)buffers.get(agent);
00054             <font class="keywordflow">return</font> taggedBuffers.<a class="code" href="classTaggedBuffers.html#a2">dequeue</a>(messageTag);
00055         }
00056         <font class="keywordflow">throw</font> <font class="keyword">new</font> Exceptional(factory.<a class="code" href="interfaceDataFactory.html#a0">makeEmpty</a>());
00057     }   
00058 
00059 
<a name="l00060"></a><a class="code" href="classSchedule.html#a2">00060</a>     <font class="keyword">public</font> synchronized <a class="code" href="interfaceAgent.html">Agent</a> <a class="code" href="interfaceScheduling.html#a2">activate</a>(<a class="code" href="interfaceAction.html">Action</a> action)<font class="keyword"> </font>{
00061         <a class="code" href="interfaceAgent.html">Agent</a> agent = factory.<a class="code" href="interfaceDataFactory.html#a11">makeAgent</a>();
00062         Thread thread = <font class="keyword">new</font> Thread(action);
00063         agents.put(agent, thread);
00064         threads.put(thread, agent);
00065         buffers.put(agent, <font class="keyword">new</font> TaggedBuffers(factory));
00066         thread.start();
00067         <font class="keywordflow">return</font> agent;
00068     }
00069 
<a name="l00070"></a><a class="code" href="classSchedule.html#a3">00070</a>     <font class="keyword">public</font> synchronized <a class="code" href="interfaceEmpty.html">Empty</a> <a class="code" href="interfaceScheduling.html#a3">deactivate</a>(<a class="code" href="interfaceAgent.html">Agent</a> agent) throws <a class="code" href="classExceptional.html">Exceptional</a> {
00071         <font class="keywordflow">if</font> (agents.containsKey(agent)) {
00072             Thread thread = (Thread)(agents.get(agent));
00073             thread.interrupt();
00074             agents.remove(agent);
00075             threads.remove(thread);
00076             <font class="keywordflow">return</font> factory.<a class="code" href="interfaceDataFactory.html#a0">makeEmpty</a>();
00077         }
00078         <font class="keywordflow">throw</font> <font class="keyword">new</font> Exceptional(factory.<a class="code" href="interfaceDataFactory.html#a0">makeEmpty</a>());
00079     }
00080 
<a name="l00081"></a><a class="code" href="classSchedule.html#a4">00081</a>     <font class="keyword">public</font> synchronized <a class="code" href="interfaceAgent.html">Agent</a> <a class="code" href="interfaceScheduling.html#a4">currentAgent</a>()<font class="keyword"> </font>{
00082         <font class="keywordflow">return</font> (<a class="code" href="interfaceAgent.html">Agent</a>)(threads.get(Thread.currentThread()));
00083     }
00084 
<a name="l00085"></a><a class="code" href="classSchedule.html#a5">00085</a>     <font class="keyword">public</font> <a class="code" href="interfaceInt.html">Int</a> <a class="code" href="interfaceScheduling.html#a5">currentTime</a>()<font class="keyword"> </font>{
00086         <font class="keywordflow">return</font> factory.<a class="code" href="interfaceDataFactory.html#a2">makeInt</a>((Calendar.getInstance()).get(Calendar.SECOND));
00087 
00088     }
00089 
<a name="l00090"></a><a class="code" href="classSchedule.html#a6">00090</a>     <font class="keyword">public</font> <a class="code" href="interfaceInt.html">Int</a> <a class="code" href="interfaceScheduling.html#a6">chooseNatural</a>()<font class="keyword"> </font>{
00091         <font class="keywordflow">return</font> factory.<a class="code" href="interfaceDataFactory.html#a2">makeInt</a>((<font class="keyword">new</font> Random()).nextInt());
00092     }
00093 
00094 }
00095 
00096 
00097         
</pre></div>

<hr>
<center>
<i>Action Java Compiler Runtime, written by Tijs van der Storm &copy; 2002. </i>
</center>
